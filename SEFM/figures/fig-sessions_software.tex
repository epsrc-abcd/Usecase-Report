\begin{figure}[t]
\begin{center}
\begin{tikzpicture}
%	\draw[dotted, help lines]		(0,0) grid (12, 8);

%	\tikzset{myshape/.style={draw, minimum width = 0.5cm, minimum height = 0.5cm}}
	\tikzset{myshape/.style={draw, circle, minimum size = 0.5cm}}
	\tikzset{vertrec/.style={minimum width = 0.8cm,minimum height =2cm}}
	\coordinate (top)	at (6, 8);

	% Global protocol
	\node[myshape]									(ScribbleIn)	at	(top)	{};
	\node[above = 0cm of ScribbleIn]											{\scriptsize Global Protocol};

	% Verify
	\node[myshape, below = 0.3cm of ScribbleIn]		(Verify)				{};
	\draw[->]		(ScribbleIn) -- node[left] {\scriptsize verify} (Verify);

	% Local Protocols
	\node[below = 0.5cm of Verify]					(LocalC)				{\dots};
	\node[myshape, left = 0cm of LocalC]			(LocalL)				{};
	\node[myshape, right = 0cm of LocalC]			(LocalR)				{};

	\node[below = 0.25cm of Verify, minimum width = 2cm, minimum height = 1cm]	(Local)	{};
	\node[below = 0 of LocalC]											{\scriptsize Local Protocols};

	\draw[->] let
		\p1	=	(LocalL.north),
		\p2	=	(Verify.west),
		\p3	=	(Verify.south)
	in
		(\x2, \y3)	--	node[left]	{\scriptsize project}	(\x2, \y1);
		
	\draw[<-] let
		\p1	=	(LocalR.north),
		\p2	=	(Verify.east),
		\p3	=	(Verify.south)
	in
		(\x2, \y3)	--	node[right]	{\scriptsize synthesis}	(\x2, \y1);

	% Typecheck
	\node[vertrec, left = 1.25cm of Local]			(Exec)					{};
	\node[above = 0 of Exec]												{\scriptsize Verified Code};
	\node[left = 1.50cm of Local]					(ExecC)					{\vdots};
	\node[myshape, above= 0cm of ExecC]				(ExecT)					{};
	\node[myshape, below= 0cm of ExecC]				(ExecB)					{};
	
	\draw[->]	(Local)	-- node[above]  (TLabel) {\scriptsize typecheck}	(Exec);

	% Monitor
	\node[vertrec, right = 0.75cm of Local]			(Monitor)				{};
	\node[above = 0cm of Monitor]											{ \scriptsize monitor };

	\node[right = 1cm of Local]						(MonC)					{\vdots};
	\node[myshape, above= 0cm of MonC]				(MonT)					{};
	\node[myshape, below= 0cm of MonC]				(MonB)					{};

	% Execute
	\node[vertrec, right = 0.25cm of Monitor]		(Run)					{};
	\node[above = 0cm of Run]												{ \scriptsize execute };

	\node[right = 0.75cm of MonC]					(RunC)					{\vdots};
	\node[myshape, above= 0cm of RunC]				(RunT)					{};
	\node[myshape, below= 0cm of RunC]				(RunB)					{};

%	\draw[<->]	(MonC) -- (RunC);
	\draw[<->]	(MonT) -- (RunT);
	\draw[<->]	(MonB) -- (RunB);

	% Code
	\node[below = 0.75cm of Local]					(Code)					{\dots};
	\node[myshape, left = 0cm of Code]				(CodeL)					{};
	\node[myshape, right = 0cm of Code]				(CodeR)					{};
	\node[below = 0.1 of Code]												{\scriptsize Software Source Code};

	\draw[->]	(Local)	--	(Monitor.west);	
	
	\draw[->] let
		\p1	=	(CodeL),
		\p2	=	(TLabel)
	in
		(CodeL)	--	(\x2, \y1)	--	(TLabel);

	\draw[->] let
		\p1	=	(CodeR),
		\p2	=	(Run)
	in
		(CodeR)	--	(\x2, \y1)	--	(Run);
		
	\draw[->]	(Code) -- node[right] {\scriptsize inference} (Local);
\end{tikzpicture}
\end{center}
\caption{Use of Session Types in Software Development}
\label{fig:diagram}
\end{figure}