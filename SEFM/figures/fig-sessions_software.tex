\begin{figure}[t]
\begin{center}
\begin{tikzpicture}
%	\draw[dotted, help lines]		(0,0) grid (12, 8);

	\tikzset{myarrowstyle/.style={line width=1.2}}
	\tikzset{myarrow/.style={->, myarrowstyle}}
	\tikzset{mybiarrow/.style={<->, myarrowstyle}}
	
	\tikzset{myshape/.style={draw, rounded corners, minimum width = 0.7cm, minimum height = 0.5cm}}
%	\tikzset{myshape/.style={draw, circle, minimum size = 0.5cm}}
	\tikzset{vertrec/.style={minimum width = 1cm,minimum height =2cm}}
	\coordinate (top)	at (6, 8);

	% Global protocol
	\node[myshape]									(ScribbleIn)	at	(top)	{};
	\node[above = 0cm of ScribbleIn]											{\scriptsize Global Protocol};

	% Verify
	\node[myshape, below = 1cm of ScribbleIn]		(Verify)				{};
	\node[above = 0 of Verify]						(VerifyLabel)				{\scriptsize Verified Global Protocol};
	\draw[myarrow]		(ScribbleIn) -- node[left] {\scriptsize verify} (VerifyLabel);

	% Local Protocols
	\node[below = 1.2cm of Verify]					(LocalC)				{\dots};
	\node[myshape, left = 0cm of LocalC]			(LocalL)				{};
	\node[myshape, right = 0cm of LocalC]			(LocalR)				{};

	\node[below = 1.05cm of Verify, minimum width = 2.4cm, minimum height = 0.5cm]	(Local)	{};
	\node[above = 0 of Local]						(LocalLabel)			{\scriptsize Local Protocols};
	
	\draw[myarrow]	($(Verify.south) - (0.2, 0)$)	--
					node[left]	{\scriptsize project}
					($(LocalLabel.north) - (0.2, 0)$);
					
	\draw[myarrow]	($(LocalLabel.north) + (0.2, 0)$)	--
					node[right]	{\scriptsize synthesis}
					($(Verify.south) + (0.2, 0)$);

%	\draw[->] let
%		\p1	=	(LocalL.north),
%		\p2	=	(Verify.west),
%		\p3	=	(Verify.south)
%	in
%		(\x2, \y3)	--	node[left]	{\scriptsize project}	(\x2, \y1);
%		
%	\draw[<-] let
%		\p1	=	(LocalR.north),
%		\p2	=	(Verify.east),
%		\p3	=	(Verify.south)
%	in
%		(\x2, \y3)	--	node[right]	{\scriptsize synthesis}	(\x2, \y1);

	% Typecheck
	\node[vertrec, left = 2cm of Local]			(Exec)					{};
	\node[above = 0 of Exec]
	{
		\scriptsize
		\begin{tabular}{c}
			Verified Software\\
			Source Code
		\end{tabular}
	};
	\node[left = 2.35cm of Local]					(ExecC)					{\vdots};
	\node[myshape, above= 0cm of ExecC]				(ExecT)					{};
	\node[myshape, below= 0cm of ExecC]				(ExecB)					{};
	
	\draw[myarrow]	(Local)	--
					node[above]  (TLabel) {
											\scriptsize
											\begin{tabular}{c}
												type-check\\
												verify
											\end{tabular}
										}
					(Exec);

	% Monitor
	\node[vertrec, right = 2cm of Local]			(Monitor)				{};
	\node[above = 0cm of Monitor]											{ \scriptsize monitor };

	\node[right = 2.35cm of Local]					(MonC)					{\vdots};
	\node[myshape, above= 0cm of MonC]				(MonT)					{};
	\node[myshape, below= 0cm of MonC]				(MonB)					{};

	\draw[myarrow]	(Local)	--
					node[above] {
									\scriptsize
									\begin{tabular}{c}
										state\\
										machine
									\end{tabular}
								}
					(Monitor.west);	

	% Execute
	\node[vertrec, right = 0.25cm of Monitor]		(Run)					{};
	\node[above = 0cm of Run]												{ \scriptsize execute };

	\node[right = 0.95cm of MonC]					(RunC)					{\vdots};
	\node[myshape, above= 0cm of RunC]				(RunT)					{};
	\node[myshape, below= 0cm of RunC]				(RunB)					{};

%	\draw[<->]	(MonC) -- (RunC);
	\draw[mybiarrow]	(MonT) -- (RunT);
	\draw[mybiarrow]	(MonB) -- (RunB);

	% Code
	\node[below = 1.2cm of Local]						(Code)					{\dots};
	\node[myshape, left = 0cm of Code]				(CodeL)					{};
	\node[myshape, right = 0cm of Code]				(CodeR)					{};
	\node[above = 0.1 of Code]						(CodeLabel)				{\scriptsize Software Source Code};

	\draw[myarrow]	(CodeLabel) -- node[right] {\scriptsize inference} (Local);

	\draw[myarrow]	(CodeL)	-|	(TLabel);
	\draw[myarrow]	(CodeR)	-|	(Run);

\end{tikzpicture}
\end{center}
%\vspace{-2mm}
\caption{Use of Session Types in Software Development}
\label{fig:diagram}
\end{figure}